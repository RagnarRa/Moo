var app=angular.module("evaluationApp",["ngRoute"]);app.config(["$routeProvider","$sceDelegateProvider",function(a,b){a.when("/",{templateUrl:"src/Views/login.html",controller:"LoginController"}).when("/admin",{templateUrl:"src/Views/admin.html",controller:"AdminController"}).when("/createeval",{templateUrl:"src/Views/create-eval.html",controller:"CreateEvalController"}).when("/student",{templateUrl:"src/Views/student.html",controller:"StudentController"}).when("/answereval/:courseID/:semester/:evalID",{templateUrl:"src/Views/answer-eval.html",controller:"AnswerEvalController"}).otherwise({redirectTo:"/"}),b.resourceUrlWhitelist(["self","http://dispatch.hir.is/api/**"])}]),angular.module("evaluationApp").controller("AdminController",["$scope","$location","$filter","UserService","TemplateService",function(a,b,c,d,e){a.templates=[],e.getTemplates().success(function(b){a.templates=b}).error(function(a,b,c){console.log("Get templates error, status: "+b+", Headers:"),console.log(c)}),a.createEval=function(){b.path("/createeval")},a.addTemplate=function(){var b=c("date")(a.startDate,"yyyy-MM-ddTHH:mm:ss.sssZ","GMT"),d=c("date")(a.endDate,"yyyy-MM-ddTHH:mm:ss.sssZ","GMT");console.log("Template ID: "+a.templateID),console.log("Start date formatted: "+b),console.log("End date formatted: "+d),e.addEvaluation(a.templateID,b,d).success(function(){console.log("Successfully added a template..")}).error(function(a,b,c){console.log("Login error, status: "+b+", Headers:"),console.log(c)})},a.test=function(){var a=null;e.getEvaluations().success(function(b){a=b,console.log("Evaluation templates: "),console.log(a)}),e.getEvaluationByID(42).success(function(a){console.log("Evaluation with ID 42"),console.log(a)}),e.getEvaluationByID(50).success(function(a){console.log("Evaluation with ID 50"),console.log(a)})}}]),angular.module("evaluationApp").controller("AnswerEvalController",["$scope","$location","$routeParams","TemplateService",function(a,b,c,d){a.evaluation={},a.evaluationAnswers=[],a.teachers=[],a.courseAnswers=[],a.teacherAnswers={};var e=c.courseID,f=c.semester,g=c.evalID;console.log("Course ID "+e+", semester: "+f+", evalID: "+g),d.getEvaluationForCourseByEvalID(e,f,g).success(function(b){console.log("RECEIVED EVALUATION: "),console.dir(b),a.evaluation=b}).success(function(){d.getTeachersForCourse(e,f).success(function(b){console.log("Course questions: "),console.dir(a.evaluation.CourseQuestions),console.log("RECEIVED TEACHERS: "),console.dir(b),a.teachers=b;for(var c=0;c<a.teachers.length;c++)a.teacherAnswers[a.teachers[c].SSN]=[]})}),a.saveEval=function(){var c=a.courseAnswers;for(var h in a.teacherAnswers)for(var i=0;i<a.teacherAnswers[h].length;i++)c.push({TeacherSSN:h,QuestionID:a.teacherAnswers[h][i].QuestionID,Value:a.teacherAnswers[h][i].Value});console.log("All answers"),console.dir(c),d.saveAnswersToEvaluationInCourse(e,f,g,c).success(function(){console.log("Answers to evaluation successfully saved.."),b.path("/student")})}}]),angular.module("evaluationApp").controller("CreateEvalController",["$scope","$location","UserService","TemplateService",function(a,b,c,d){a.questions={CourseQuestions:[],TeacherQuestions:[]},a.courseQuestionType="",a.teacherQuestionType="",a.addQuestion=function(b){0===b?"text"!==a.courseQuestionType?(console.log("not text"),a.questions.CourseQuestions.push({Index:a.questions.CourseQuestions.length,Text:"",TextEN:"",ImageURL:"",Type:a.courseQuestionType,Answers:[]})):(console.log("text"),a.questions.CourseQuestions.push({Index:a.questions.CourseQuestions.length,Text:"",TextEN:"",ImageURL:"",Type:a.courseQuestionType})):1===b&&("text"!==a.teacherQuestionType?(console.log("not text"),a.questions.TeacherQuestions.push({Index:a.questions.TeacherQuestions.length,Text:"",TextEN:"",ImageURL:"",Type:a.teacherQuestionType,Answers:[]})):(console.log("text"),a.questions.TeacherQuestions.push({Index:a.questions.TeacherQuestions.length,Text:"",TextEN:"",ImageURL:"",Type:a.teacherQuestionType})))},a.addAnswer=function(b,c){0===c?a.questions.CourseQuestions[b].Answers.push({Text:"",TextEN:"",ImageURL:"",Weight:0}):1===c&&a.questions.TeacherQuestions[b].Answers.push({Text:"",TextEN:"",ImageURL:"",Weight:0})},a.createEval=function(c){a.evaluation=c,a.evaluation.CourseQuestions=a.questions.CourseQuestions,a.evaluation.TeacherQuestions=a.questions.TeacherQuestions,d.createTemplate(a.evaluation).success(function(){console.log("Template successfully created."),b.path("/admin")}).error(function(a,b,c){console.log("Template creation error, status: "+b+", Headers:"),console.log(c)})}}]),angular.module("evaluationApp").controller("LoginController",["$scope","$location","LoginService",function(a,b,c){a.username="",a.token="",a.logIn=function(a,d){c.logIn(a,d).success(function(a){b.path("admin"===a.User.Role?"/admin":"/student")}).error(function(a,b,c){console.log("Login error, status: "+b+", Headers:"),console.log(c)})}}]),angular.module("evaluationApp").controller("StudentController",["$scope","$location","TemplateService",function(a,b,c){c.getEvaluationsForStudent().success(function(b){a.evaluations=b,console.log(b)}).error(function(a,b,c){console.log("Get Evaluations For Student Error, status: "+b+", Headers:"),console.log(c)})}]),angular.module("evaluationApp").controller("TestController",["$scope",function(a){a.username="Ragnar"}]),angular.module("evaluationApp").filter("SingleMultipleQuestionFilter",function(){return function(a){var b=[];return angular.forEach(a,function(a){("single"===a.Type||"multiple"===a.Type)&&b.push(a)}),b}}),angular.module("evaluationApp").filter("TextQuestionFilter",function(){return function(a){var b=[];return angular.forEach(a,function(a){"text"===a.Type&&b.push(a)}),b}}),angular.module("evaluationApp").factory("LoginService",["$http","UserService",function(a,b){return{logIn:function(c,d){var e={user:c,pass:d};return a({method:"POST",url:"http://dispatch.ru.is/demo/api/v1/login",data:e}).success(function(a){console.log("Logged in!"),console.dir(a),b.setToken(a.Token),b.setUsername(a.User.Username),console.log("getToken: "+b.getToken())}).error(function(){console.log("Log in error!")})}}}]),angular.module("evaluationApp").factory("TemplateService",["$http","UserService",function(a,b){return{createTemplate:function(c){var d=b.getToken();return console.log("Using token: "+d),a({method:"POST",url:"http://dispatch.ru.is/demo/api/v1/evaluationtemplates",data:c,headers:{Authorization:"Basic "+d}})},getTemplates:function(){var c=b.getToken();return console.log("Using token: "+c),a({method:"GET",url:"http://dispatch.ru.is/demo/api/v1/evaluationtemplates",data:null,headers:{Authorization:"Basic "+c}})},getTemplateByID:function(c){var d=b.getToken();return console.log("Using token: "+d),a({method:"GET",url:"http://dispatch.ru.is/demo/api/v1/evaluationtemplates/"+c,data:null,headers:{Authorization:"Basic "+d}})},addEvaluation:function(c,d,e){var f=b.getToken();return console.log("Using token: "+f),a({method:"POST",url:"http://dispatch.ru.is/demo/api/v1/evaluations",data:{TemplateID:c,StartDate:d,EndDate:e},headers:{Authorization:"Basic "+f}})},getEvaluations:function(){var c=b.getToken();return console.log("Using token: "+c),a({method:"GET",url:"http://dispatch.ru.is/demo/api/v1/evaluations",data:null,headers:{Authorization:"Basic "+c}})},getEvaluationByID:function(c){var d=b.getToken();return console.log("Using token: "+d),a({method:"GET",url:"http://dispatch.ru.is/demo/api/v1/evaluations/"+c,data:null,headers:{Authorization:"Basic "+d}})},getCoursesForStudent:function(){var c=b.getToken();return console.log("Using token: "+c),a({method:"GET",url:"http://dispatch.ru.is/demo/api/v1/my/courses",data:null,headers:{Authorization:"Basic "+c}})},getEvaluationsForStudent:function(){var c=b.getToken();return console.log("Using token: "+c),a({method:"GET",url:"http://dispatch.ru.is/demo/api/v1/my/evaluations",data:null,headers:{Authorization:"Basic "+c}})},getTeachersForCourse:function(c,d){var e=b.getToken();return console.log("Using token: "+e),a({method:"GET",url:"http://dispatch.ru.is/demo/api/v1/courses/"+c+"/"+d+"/teachers",data:null,headers:{Authorization:"Basic "+e}})},getEvaluationForCourseByEvalID:function(c,d,e){var f=b.getToken();return console.log("Using token: "+f),a({method:"GET",url:"http://dispatch.ru.is/demo/api/v1/courses/"+c+"/"+d+"/evaluations/"+e,data:null,headers:{Authorization:"Basic "+f}})},saveAnswersToEvaluationInCourse:function(c,d,e,f){var g=b.getToken();return console.log("Using token: "+g),a({method:"POST",url:"http://dispatch.ru.is/demo/api/v1/courses/"+c+"/"+d+"/evaluations/"+e,data:f,headers:{Authorization:"Basic "+g}})}}}]),angular.module("evaluationApp").factory("UserService",[function(){var a="",b="",c="";return{setToken:function(a){b=a},getToken:function(){return console.log("Inside getToken: "+b),b},setUsername:function(b){a=b},getUsername:function(){return a},setRole:function(a){c=a},getRole:function(){return c}}}]);