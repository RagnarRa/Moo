var app=angular.module("ChatApp",["ngRoute","ui.bootstrap"]);app.config(["$routeProvider",function(a){a.when("/",{templateUrl:"src/views/home.html",controller:"LoginController"}).when("/room/:roomName",{templateUrl:"src/views/room.html",controller:"RoomController"}).otherwise({redirectTo:"/"})}]),angular.module("ChatApp").controller("LoginController",["$scope","$location","SocketService",function(a,b,c){a.username="",a.usernameTaken=!1,a.rooms={},a.showRooms=c.getUsername(),a.roomCount=0,a.selectedRoom=null,a.nameOfRoomToCreate=null;var d=io.connect("http://localhost:8080");d.emit("rooms"),a.connectToServer=function(){a.connectionForm.$valid&&d&&d.emit("adduser",a.username,function(b){b?(c.setConnected(d),c.setUsername(a.username),d.emit("rooms"),a.showRooms=!0):a.usernameTaken=!0,a.$apply()})},a.joinRoom=function(){b.path(null!==a.selectedRoom?"/room/"+a.selectedRoom:"/room/lobby")},a.createRoom=function(){a.createRoomForm.$valid&&b.path("/room/"+a.nameOfRoomToCreate)},d&&d.on("roomlist",function(b){a.rooms=b,a.roomCount=Object.keys(b).length,a.$apply()})}]),angular.module("ChatApp").controller("RoomController",["$scope","$routeParams","SocketService","$location",function(a,b,c,d){function e(){var b=/^(msg) (\S+) (.+)$/,d=a.currentMessage.message.match(b),e=!1;for(var g in a.users)g===d[2]&&(e=!0);if(e){f.emit("privatemsg",{nick:d[2],message:d[3]},function(){});for(var h=!1,i=!1,j=0;j<a.privateMessages.length;j++)if(a.privateMessages[j].from===d[2]){a.privateMessages[j].messages.push({from:c.getUsername(),msg:d[3]}),h=!0;break}for(h||a.privateMessages.push({from:d[2],messages:[{from:c.getUsername(),msg:d[3]}]}),j=0;j<a.tabs.length;j++)if(a.tabs[j].title===d[2]){i=!0;break}i||a.tabs.push({title:d[2],isActive:!1,isRoom:!1})}}a.roomName=b.roomName,a.currentMessage={message:""},a.currentPM={PM:""},a.privateMessages=[],a.tabs=[{title:a.roomName,active:!0,isRoom:!0}];var f=c.getSocket();f?(f.emit("joinroom",{room:a.roomName,pass:""},function(b,c){b||"banned"!==c||d.path("/"),a.$apply()}),f.on("updatechat",function(b,c){console.dir(c),console.log("Message to room: "+b),b==a.roomName&&(a.messages=c),a.$apply()}),f.on("updateusers",function(b,c,d){if(b===a.roomName){a.users=c;for(var e in d)a.users[e]=d[e];console.dir(d),console.dir(a.users)}a.$apply()}),f.on("kicked",function(a,b){c.getUsername()===b&&d.path("/")}),f.on("banned",function(a,b){c.getUsername()===b&&d.path("/")}),f.on("recv_privatemsg",function(b,c){for(var d=!1,e=!1,f=0;f<a.privateMessages.length;f++)if(a.privateMessages[f].from===b){a.privateMessages[f].messages.push({from:b,msg:c}),d=!0;break}for(d||a.privateMessages.push({from:b,messages:[{from:b,msg:c}]}),f=0;f<a.tabs.length;f++)if(a.tabs[f].title===b){e=!0;break}e||a.tabs.push({title:b,active:!1,isRoom:!1}),a.$apply()})):d.path("/"),a.send=function(){if(a.currentMessage.message.length>0&&"/"==a.currentMessage.message[0]){var b;a.currentMessage.message=a.currentMessage.message.slice(1);var c=/^kick \S+$/;null!==a.currentMessage.message.match(c)&&(c=/[^\s]+\S+$/,b=a.currentMessage.message.match(c),f.emit("kick",{user:b[0],room:a.roomName},function(){})),c=/^ban \S+$/,null!==a.currentMessage.message.match(c)&&(c=/[^\s]+\S+$/,b=a.currentMessage.message.match(c),f.emit("ban",{user:b[0],room:a.roomName},function(){}),f.emit("kick",{user:b[0],room:a.roomName},function(){})),c=/^unban \S+$/,null!==a.currentMessage.message.match(c)&&(c=/[^\s]+\S+$/,b=a.currentMessage.message.match(c),f.emit("unban",{user:b[0],room:a.roomName},function(){})),c=/^op \S+$/,null!==a.currentMessage.message.match(c)&&(c=/[^\s]+\S+$/,b=a.currentMessage.message.match(c),console.log("Op: "+b[0]),f.emit("op",{user:b[0],room:a.roomName},function(){})),c=/^deop \S+$/,null!==a.currentMessage.message.match(c)&&(c=/[^\s]+\S+$/,b=a.currentMessage.message.match(c),console.log("Deop: "+b[0]),f.emit("deop",{user:b[0],room:a.roomName},function(a){console.log(a?"Deopped..":"Not deopped")})),c=/^msg \S+ .+$/,null!==a.currentMessage.message.match(c)&&e(),a.currentMessage.message=""}else f&&""!==a.currentMessage.message&&(f.emit("sendmsg",{roomName:a.roomName,msg:a.currentMessage.message}),a.currentMessage.message="")},a.leaveRoom=function(){f&&(f.emit("partroom",a.roomName),d.path("/"))},a.keyPress=function(b,c,d){13===b.keyCode&&(c?a.sendPM(d):a.send())},a.sendPM=function(b){f.emit("privatemsg",{nick:b,message:a.currentPM.PM},function(){});for(var d=0;d<a.privateMessages.length;d++)if(a.privateMessages[d].from===b){a.privateMessages[d].messages.push({from:c.getUsername(),msg:a.currentPM.PM});break}a.currentPM.PM=""}}]),angular.module("ChatApp").factory("SocketService",["$http",function(){var a,b="";return{setConnected:function(b){a=b},setUsername:function(a){b=a},getUsername:function(){return b},getSocket:function(){return a}}}]);