var app=angular.module("ChatApp",["ngRoute"]);app.config(["$routeProvider",function(a){a.when("/",{templateUrl:"src/views/home.html",controller:"LoginController"}).when("/room/:roomName",{templateUrl:"src/views/room.html",controller:"RoomController"}).otherwise({redirectTo:"/"})}]),angular.module("ChatApp").controller("LoginController",["$scope","$location","SocketService",function(a,b,c){a.username="",a.usernameTaken=!1,a.rooms={},a.showRooms=c.getUsername(),a.roomCount=0,a.selectedRoom=null,a.nameOfRoomToCreate=null;var d=io.connect("http://localhost:8080");d.emit("rooms"),a.connectToServer=function(){d&&d.emit("adduser",a.username,function(b){b?(c.setConnected(d),c.setUsername(a.username),d.emit("rooms"),a.showRooms=!0):a.usernameTaken=!0,a.$apply()})},a.joinRoom=function(){null!==a.selectedRoom?(console.log("Joining room: "+a.selectedRoom),console.dir(a.selectedRoom),b.path("/room/"+a.selectedRoom)):b.path("/room/lobby")},a.createRoom=function(){d.emit("joinroom",{room:a.nameOfRoomToCreate,pass:""},function(){}),b.path("/room/"+a.nameOfRoomToCreate),console.log("Room to create: "+a.nameOfRoomToCreate)},d&&d.on("roomlist",function(b){a.rooms=b,console.dir(b),a.roomCount=Object.keys(b).length,a.$apply()})}]),angular.module("ChatApp").controller("RoomController",["$scope","$routeParams","SocketService","$location",function(a,b,c,d){a.roomName=b.roomName,a.currentMessage="";var e=c.getSocket();e&&(e.emit("joinroom",{room:a.roomName,pass:""},function(b,c){b||"banned"!==c||d.path("/"),a.$apply()}),e.on("updatechat",function(b,c){console.log(c),a.messages=c,a.$apply()}),e.on("updateusers",function(b,c){b===a.roomName&&(a.users=c),a.$apply()}),e.on("kicked",function(a,b){console.log("Notandanafn mitt: "+c.getUsername()),console.log("Kicked: "+b),c.getUsername()===b&&d.path("/")}),e.on("banned",function(a,b){c.getUsername()===b&&d.path("/")})),a.send=function(){if(a.currentMessage.length>0&&"/"==a.currentMessage[0]){a.currentMessage=a.currentMessage.slice(1);var b=/^kick \S+$/;if(null!==a.currentMessage.match(b)){b=/[^\s]+\S+$/;var c=a.currentMessage.match(b);console.log("Notandi: "+c[0]),console.log("Room: "+a.roomName),e.emit("kick",{user:c[0],room:a.roomName},function(){})}if(b=/^ban \S+$/,null!==a.currentMessage.match(b)){b=/[^\s]+\S+$/;var c=a.currentMessage.match(b);e.emit("ban",{user:c[0],room:a.roomName},function(){})}}else e&&(e.emit("sendmsg",{roomName:a.roomName,msg:a.currentMessage}),a.currentMessage="")},a.leaveRoom=function(){e&&(e.emit("partroom",a.roomName),d.path("/"))},a.keyPress=function(b){13===b.keyCode&&a.send()}}]),angular.module("ChatApp").factory("SocketService",["$http",function(){var a,b="";return{setConnected:function(b){a=b},setUsername:function(a){b=a},getUsername:function(){return b},getSocket:function(){return a}}}]);